<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://www.nightwolf.in/nightwolf-cotribution/performance/">
        <link rel="shortcut icon" href="../../img/favi.png">
        
        <title>Performance-Troubleshooting - nightWolf</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'G-DSYZJFJTEB', 'nightwolf.in');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="../..">nightWolf</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Performance-Troubleshooting</a>
                            </li>
                            <li class="navitem">
                                <a href="../../interview/" class="nav-link">Interview-Preparation</a>
                            </li>
                            <li class="navitem">
                                <a href="../../linux.md" class="nav-link">Linux</a>
                            </li>
                            <li class="navitem">
                                <a href="../network" class="nav-link">Network</a>
                            </li>
                            <li class="navitem">
                                <a href="../../db/" class="nav-link">Database</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../.." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../interview/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#system-performance" class="nav-link">System Performance</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#tools-helpful-in-your-investigation" class="nav-link">Tools helpful in your investigation:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#perfomance-isssues-due-to-high-cpu-usage" class="nav-link">Perfomance isssues due to high CPU Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#performance-issues-due-to-high-memory-usage" class="nav-link">Performance issues due to high Memory Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#performance-issues-due-to-high-disk-io-usage" class="nav-link">Performance issues due to high Disk IO Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#network-performance-issues" class="nav-link">Network Performance Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="system-performance">System Performance<a class="headerlink" href="#system-performance" title="Permanent link"></a></h2>
<ul>
<li>
<p><code>Definition:</code>
  System performance is a measure of the amount of useful work done by a System in a time range. </p>
</li>
<li>
<p><code>OS/CPU Load:</code> The average amount of processes using or waiting for CPU allocation over a period of time.</p>
</li>
</ul>
<p>Usually System Performance issues can be identified by observing slowness in services offered by OS and it mostly happen due to any of the below reasons. </p>
<pre><code>    - high CPU Usage 
    - high Memory Usage
    - high Disk IO Usage
    - Network Performance Issues
    - Software Bugs like memory leaks, Kernel bugs etc.
</code></pre>
<p>We will try to break your investigation steps into major bullet points and helps you to find the root causes of the issue. </p>
<h2 id="tools-helpful-in-your-investigation">Tools helpful in your investigation:<a class="headerlink" href="#tools-helpful-in-your-investigation" title="Permanent link"></a></h2>
<p><img alt="!image" src="../../img/TroubleShooting.jpg" /></p>
<ul>
<li><a href="https://linux.die.net/man/1/top" target="_blank">top</a></li>
<li><a href="https://linux.die.net/man/1/mpstat" target="_blank">mpstat</a></li>
<li><a href="https://linux.die.net/man/1/sar" target="_blank">sar</a></li>
<li><a href="https://linux.die.net/man/1/free" target="_blank">free</a></li>
<li><a href="https://linux.die.net/man/1/strace" target="_blank">strace</a></li>
<li><a href="https://linux.die.net/man/1/iotop" target="_blank">iotop</a></li>
<li><a href="https://www.thegeekstuff.com/2011/07/iostat-vmstat-mpstat-examples/" target="_blank">iostat</a></li>
<li><a href="https://tldp.org/LDP/nag2/x-087-2-iface.netstat.html" target="_blank">netstat</a></li>
<li><a href="https://www.thegeekstuff.com/2014/11/pidstat-examples/" target="_blank">pidstat</a></li>
<li><a href="https://www.thegeekstuff.com/2011/07/iostat-vmstat-mpstat-examples/" target="_blank">vmstat</a></li>
<li><a href="https://www.tcpdump.org/manpages/tcpdump.1.html" target="_blank">tcpdump</a></li>
<li><a href="http://iptraf.seul.org/about.html" target="_blank">iptraf</a></li>
<li><a href="https://git.kernel.org/pub/scm/linux/kernel/git/axboe/blktrace.git/tree/README" target="_blank">blktrace</a></li>
<li><a href="https://www.tecmint.com/10-lsof-command-examples-in-linux/" target="_blank">lsof</a></li>
<li>
<p><a href="https://www.networkworld.com/article/3633889/looking-at-your-linux-systems-network-interface-with-ethtool.html" target="_blank">ethtool</a></p>
</li>
<li>
<p><a href="https://github.com/v-nightwolf/nightwolf-cotribution/raw/4fc6bb408de57e9776d2d041e5573990928fbecc/TypeClip%20-%201.0.5933.22582.exe">type-clip</a> : A very good tool when you have to paste something into virtual consoles. </p>
</li>
<li><a href="https://github.com/rackerlabs/recap#installation" target="_blank">recap</a> : To capture historic stats of a server. This tool is almost harmless and captures a lot of information. You can add this tool to your default package list in your environment.
<br></li>
</ul>
<p>You can install these tools  very easily using below command:</p>
<p><code>yum install -y  lsof sysstat iptraf tcpdump procps-ng net-tools strace iotop ethtool blktrace</code></p>
<p><br></p>
<h4 id="you-can-start-your-investigation-by-executing-small-script-which-will-gather-a-lot-of-system-stats-for-you">You can start your investigation by executing small script, which will gather a lot of system stats for you:<a class="headerlink" href="#you-can-start-your-investigation-by-executing-small-script-which-will-gather-a-lot-of-system-stats-for-you" title="Permanent link"></a></h4>
<pre><code>bash &lt;(curl -s https://raw.githubusercontent.com/v-nightwolf/nightwolf-cotribution/main/server_stats.sh)
</code></pre>
<p>The output of above script will look like this: </p>
<pre><code>############################################

Server Uptime: 1days 6:43:23

Load Average: Current 0.26
Load Average: 15min Average 0.26

#### Printing CPU stats: ####
01:15:26 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01:15:26 PM  all    1.47    0.00    0.48    0.02    0.00    0.12    0.00    0.00    0.00   97.91


###RAM usage###
Free Ram: 569.93MB
Used RAM: 3171.23MB

15% ram left
RAM ALERT: Low!

TOP RAM CONSUMER: /opt/mongodb/mms/jdk/bin/mms-app
RAM Usage (RSS): 1857.43 MB
Total Number of RAM Processes: 2
Total RAM Usage for all /opt/mongodb/mms/jdk/bin/mms-app processes =  2287.56 MB
61.15% used by /opt/mongodb/mms/jdk/bin/mms-app


###CPU usage###
Top Process:  /opt/mongodb/mms/jdk/bin/mms-app
CPU % for SINGLE Top Process =  4.2
number of processes this is running: 2
Total CPU % for /opt/mongodb/mms/jdk/bin/mms-app =  4.8

############################################
</code></pre>
<h2 id="perfomance-isssues-due-to-high-cpu-usage">Perfomance isssues due to high CPU Usage<a class="headerlink" href="#perfomance-isssues-due-to-high-cpu-usage" title="Permanent link"></a></h2>
<p>Every performance issue troubleshooting should starts with <code>top</code> command:</p>
<p>and the most useful output of <code>top</code> command is: </p>
<pre><code>top - 16:18:32 up  2:52,  1 user,  load average: 0.09, 0.20, 0.22
Tasks:  99 total,   1 running,  98 sleeping,   0 stopped,   0 zombie
%Cpu(s):  3.2 us,  0.0 sy,  0.0 ni, 96.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  2889532 total,    73328 free,  2707940 used,   108264 buff/cache
KiB Swap:  2097148 total,  1206268 free,   890880 used.    48052 avail Mem
</code></pre>
<p><br></p>
<pre><code>a). 1st line contains: UPTIME and LOAD Averages
       current time and length of time since last boot
       total number of users logged in.
       system load avg over the last 1, 5 and 15 minutes
</code></pre>
<p><br></p>
<pre><code>b). 2nd line contains: TASKs
    This line shows total tasks or threads, depending on the state of the Threads-mode toggle.  
    That total is further classified as: running; sleeping; stopped; zombie
</code></pre>
<p><br></p>
<pre><code>c). 3rd line contains CPU state percentages: This will guide your investigation into a specific direction.

    As a default, percentages for these individual categories are displayed.
       us, user    : time running un-niced user processes
       sy, system  : time running kernel processes
       ni, nice    : time running niced user processes
       id, idle    : time spent in the kernel idle handler
       wa, IO-wait : time waiting for I/O completion
       hi : time spent servicing hardware interrupts
       si : time spent servicing software interrupts
       st : time stolen from this vm by the hypervisor
</code></pre>
<p>Above stats will guide your investigation into a specific direction. Depending on above CPU stats, you will be able to decide what to check next. </p>
<pre><code>* If only "%us"(time running un-niced user processes) is high that means your application is consuming more
  CPU. Now you should deep dive into process stats and process trace. We will discuss thiin more detail soon.

* If only "%sy"(time running kernel processes) is high that means you kernel level system call are consuming
  the CPU. This usually happens when there is a bug in kernel packages.

* If "%ni"(time running niced user processes) is high that means the  prioritized processes are consuming
  the CPU. You should try to depriritize the process.

* If "%id"(time spent in the kernel idle handler) is high that means your system is ideal and is not doing
  anything.

* If "%wa"(time waiting for I/O completion) is high that means your most CPU time is being spent on waiting for
  I/O completion. These waits can be due to Disk slowness or Network slowness.

* If "%hi"(time spent servicing hardware interrupts) is high that means CPU is very busy in servicing the 
  Hardware interrupts. Hardware interrupt will cause CPU to stop its current processing and go handle the 
  Hardware interrupt. Ususally hardware interrupts was generated by physical devices like disk, NIC,computer
  peripherals. You should check the hardwares attached to the machine and see if they are working fine.

* If "%si"(time spent servicing software interrupts) is high that CPU is busy serving Software interrupts.
  Usually Software interrupt occure at kernel level.

* "%st"(time stolen from this vm by the hypervisor) means that virtual CPU is being spent waiting for the 
  Hypervisor to allocate CPU to virtual machine. This stat is only applicable to Virtual machines.
</code></pre>
<h2 id="performance-issues-due-to-high-memory-usage">Performance issues due to high Memory Usage<a class="headerlink" href="#performance-issues-due-to-high-memory-usage" title="Permanent link"></a></h2>
<h2 id="performance-issues-due-to-high-disk-io-usage">Performance issues due to high Disk IO Usage<a class="headerlink" href="#performance-issues-due-to-high-disk-io-usage" title="Permanent link"></a></h2>
<h2 id="network-performance-issues">Network Performance Issues<a class="headerlink" href="#network-performance-issues" title="Permanent link"></a></h2></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2022 nightWolf</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
